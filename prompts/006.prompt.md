# ğŸ¯ ä»»å‹™ï¼šç‚º AI åŠ©ç†ç¶²ç«™ç·¨å¯«ä¸¦é©—è­‰ Extractor Functions

ä½ æ˜¯ä¸€ä½å°ˆç²¾æ–¼ç€è¦½å™¨è‡ªå‹•åŒ–æ“ä½œçš„ AI ä»£ç†ã€‚ä½ å°‡ä½¿ç”¨ **Playwright MCP å·¥å…·**ä¾†æ“ä½œçœŸå¯¦çš„ç€è¦½å™¨ï¼Œä¸¦èˆ‡ç•¶å‰é é¢é€²è¡Œäº’å‹•ã€‚

ä½ çš„ç›®æ¨™æ˜¯ç‚ºä¸€å€‹ AI åŠ©ç†èŠå¤©ç¶²ç«™ (ä¾‹å¦‚ Gemini, Claude, ChatGPT, Grok ç­‰) ç·¨å¯«ä¸€çµ„ JavaScript extractor functionsï¼Œç”¨ä¾†æå–å°è©±å…§å®¹ã€‚ä½ å°‡ä»¥è¿­ä»£çš„æ–¹å¼ï¼Œä¸€æ¬¡å°ˆæ³¨æ–¼ä¸€å€‹ functionï¼Œä¸¦ä½¿ç”¨ Playwright MCP å·¥å…·ç«‹å³é€²è¡Œé©—è­‰ã€‚

---

## ğŸ“ ä½ çš„å·¥ä½œæµç¨‹

1.  **æ¥æ”¶ Schema**ï¼šä½ æœƒæ”¶åˆ°ä¸€å€‹å®šç¾©äº†éœ€è¦æå–å“ªäº›è³‡æ–™çš„ `Extractor Functions Schema`ã€‚
2.  **ä½¿ç”¨ MCP å·¥å…·é–‹å•Ÿé é¢**ï¼šä½¿ç”¨ `mcp__playwright__browser_navigate` å°èˆªåˆ°ç›®æ¨™ç¶²ç«™ã€‚
3.  **ç·¨å¯« Function**ï¼šä½ çš„ä»»å‹™æ˜¯ç‚º schema ä¸­çš„æ¯ä¸€å€‹æ¬„ä½ç·¨å¯«æ­£ç¢ºçš„ JavaScript extractor functionã€‚
4.  **ä¸€æ¬¡ä¸€å€‹**ï¼šæ¯æ¬¡åªå°ˆæ³¨æ–¼ schema ä¸­çš„ä¸€å€‹ functionã€‚ä¸è¦ä¸€æ¬¡å¯«å®Œæ‰€æœ‰ functionsã€‚
5.  **ä½¿ç”¨ MCP å·¥å…·é©—è­‰**ï¼šæ¯å¯«å¥½ä¸€å€‹ functionï¼Œä½ å¿…é ˆ**ç«‹åˆ»**ä½¿ç”¨ `mcp__playwright__browser_evaluate` åŸ·è¡Œå®ƒï¼Œä¸¦æª¢æŸ¥å›å‚³çš„çµæœæ˜¯å¦ç¬¦åˆé æœŸã€‚
6.  **ç¢ºèªå¾Œå†ç¹¼çºŒ**ï¼šåªæœ‰ç•¶ä½ ç¢ºèªç›®å‰çš„ function èƒ½æº–ç¢ºæå–åˆ°ç›®æ¨™è³‡æ–™å¾Œï¼Œæ‰ç¹¼çºŒç·¨å¯«ä¸‹ä¸€å€‹ functionã€‚

---

## ğŸ§  é é¢ç‹€æ…‹åˆ¤æ–·

ä½ å¿…é ˆèƒ½å¤ æ„ŸçŸ¥ä¸¦è™•ç†ç•¶å‰é é¢çš„ä¸åŒç‹€æ…‹ï¼š

-   **å¦‚æœé é¢å°šæœªç™»å…¥**ï¼šä½ çš„ç¬¬ä¸€å€‹ä»»å‹™æ˜¯ç·¨å¯«ä¸€å€‹ç”¨æ–¼åµæ¸¬ã€Œç™»å…¥é é¢ã€æˆ–ã€Œå·²ç™»å…¥ç‹€æ…‹ã€çš„ functionã€‚ä¾‹å¦‚ï¼Œæª¢æŸ¥åªæœ‰åœ¨ç™»å…¥å¾Œæ‰æœƒå‡ºç¾çš„é ­åƒå…ƒç´ ã€‚ä½¿ç”¨ `mcp__playwright__browser_snapshot` ä¾†ç†è§£é é¢çµæ§‹ã€‚
-   **å¦‚æœé é¢æ²’æœ‰é–‹å•Ÿçš„å°è©±**ï¼šä½ éœ€è¦å…ˆç·¨å¯«èƒ½æ‰¾åˆ°å°è©±åˆ—è¡¨é …ç›®çš„ functionï¼Œç„¶å¾Œä½¿ç”¨ `mcp__playwright__browser_click` æ¨¡æ“¬é»æ“Šé€²å…¥å°è©±é é¢ã€‚
-   **é©—è­‰é€šç”¨æ€§**ï¼šç•¶ä½ å®Œæˆä¸€å€‹å°è©±é é¢çš„æ‰€æœ‰ functions ç·¨å¯«å’Œæ¸¬è©¦å¾Œï¼Œä½ å¿…é ˆä½¿ç”¨ `mcp__playwright__browser_click` é»æ“Š**å¦ä¸€å€‹ä¸åŒçš„å°è©±**ï¼Œç„¶å¾Œå†æ¬¡ç”¨ä½ å¯«å¥½çš„æ‰€æœ‰ functions é€²è¡Œæ¸¬è©¦ï¼Œä»¥ç¢ºä¿å®ƒå€‘ä¸æ˜¯å¯«æ­»çš„ (hard-coded)ï¼Œè€Œæ˜¯èƒ½é€šç”¨æ–¼ä»»ä½•å°è©±ã€‚

---

## ğŸ“‹ Extractor Functions Schema (ä½ çš„ç›®æ¨™)

ä½ éœ€è¦ç‚º {ASSISTANT} ç¶²ç«™ç·¨å¯«ä¸€çµ„ JavaScript extractor functionsã€‚ä»¥ä¸‹æ˜¯ TypeScript é¡å‹å®šç¾©ï¼ˆåƒ…ç”¨æ–¼åƒè€ƒï¼‰ï¼Œä½ çš„å¯¦éš›è¼¸å‡ºæ‡‰è©²æ˜¯ **JavaScript å‡½æ•¸**ã€‚

### TypeScript é¡å‹å®šç¾©ï¼ˆåƒè€ƒç”¨ï¼‰

```typescript
// æ•¸æ“šçµæ§‹
type ChatListItem = {
  id: string;
  title: string;
  updatedAt: string | null;
  isSelected: boolean;
};

type ChatMessage = {
  role: 'user' | 'assistant' | 'tool' | 'system';
  text: string;
  timestamp: string | null;
};

type Chat = {
  title: string;
  messages: ChatMessage[];
};

// Extractor å‡½æ•¸ç°½å
type ExtractorFunctions = {
  // æå–çµæ§‹åŒ–æ•¸æ“š
  extractChatList: () => ChatListItem[];
  extractChat: () => Chat | null;

  // äº’å‹•å…ƒç´ ï¼ˆè¿”å› HTMLElement ä»¥ä¾¿æ“ä½œï¼‰
  getPromptInput: () => HTMLElement | null;
  getSendButton: () => HTMLElement | null;
  getStopButton: () => HTMLElement | null;

  // ç‹€æ…‹æª¢æ¸¬
  isLoggedIn: () => boolean;
  isStreaming: () => boolean;
  getErrorMessage: () => string | null;
};
```

### JavaScript å‡½æ•¸æ ¼å¼ï¼ˆä½ çš„å¯¦éš›è¼¸å‡ºï¼‰

ä½ éœ€è¦ç·¨å¯«çš„æ¯å€‹å‡½æ•¸éƒ½æ‡‰è©²æ˜¯**å¯é€é `mcp__playwright__browser_evaluate` å·¥å…·åŸ·è¡Œçš„ JavaScript**ã€‚ä¾‹å¦‚ï¼š

```javascript
// âœ… æ­£ç¢ºç¤ºä¾‹ï¼šè¿”å›çµæ§‹åŒ–æ•¸æ“š
function extractChatList() {
  return Array.from(document.querySelectorAll('[data-chat-id]')).map(item => ({
    id: item.getAttribute('data-chat-id'),
    title: item.querySelector('.chat-title')?.textContent?.trim() || '',
    updatedAt: item.querySelector('.updated-at')?.textContent?.trim() || null,
    isSelected: item.classList.contains('selected')
  }));
}

// ä½¿ç”¨ mcp__playwright__browser_evaluate æ¸¬è©¦
// æ‡‰è¿”å›ï¼š[{ id: '123', title: 'Chat 1', updatedAt: '2025-01-10', isSelected: false }, ...]
```

```javascript
// âœ… æ­£ç¢ºç¤ºä¾‹ï¼šè¿”å› boolean ç‹€æ…‹
function isLoggedIn() {
  return document.querySelector('[data-user-avatar]') !== null;
}

// ä½¿ç”¨ mcp__playwright__browser_evaluate æ¸¬è©¦
// æ‡‰è¿”å›ï¼štrue æˆ– false
```

---

## ğŸš€ åŸ·è¡Œæ­¥é©Ÿ

1.  **é–‹å•Ÿç›®æ¨™ç¶²é **ï¼š
    ä½¿ç”¨ Playwright MCP å°èˆªåˆ° {ASSISTANT} ç›®æ¨™ç¶²ç«™

2.  **è©•ä¼°åˆå§‹ç‹€æ…‹**ï¼š
    - ç†è§£é é¢çµæ§‹å’Œç‹€æ…‹
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `isLoggedIn()` function

3.  **è¿­ä»£ç·¨å¯«èˆ‡æ¸¬è©¦ Functions**ï¼ˆä¸€æ¬¡ä¸€å€‹ï¼‰ï¼š

    **æ­¥é©Ÿ 3.1ï¼šç™»å…¥ç‹€æ…‹æª¢æ¸¬**
    - ç·¨å¯« `isLoggedIn()` function
    - ä½¿ç”¨ Playwright MCP åŸ·è¡Œä¸¦ç¢ºèªè¿”å› `true` æˆ– `false`
    - âœ… ç¢ºèªæ­£ç¢ºå¾Œæ‰ç¹¼çºŒ

    **æ­¥é©Ÿ 3.2ï¼šèŠå¤©åˆ—è¡¨æå–**
    - ç·¨å¯« `extractChatList()` function
    - ä½¿ç”¨ Playwright MCP æ¸¬è©¦ï¼Œé æœŸè¿”å›ï¼š
      ```javascript
      [
        { id: '123', title: 'Chat 1', updatedAt: '2025-01-10', isSelected: false },
        { id: '456', title: 'Chat 2', updatedAt: '2025-01-09', isSelected: true },
        ...
      ]
      ```
    - âœ… ç¢ºèªæ­£ç¢ºå¾Œæ‰ç¹¼çºŒ

    **æ­¥é©Ÿ 3.3ï¼šå°è©±å…§å®¹æå–**
    - ç·¨å¯« `extractChat()` function
    - ä½¿ç”¨ Playwright MCP æ¸¬è©¦ï¼Œé æœŸè¿”å›ï¼š
      ```javascript
      {
        title: 'My Chat Title',
        messages: [
          { role: 'user', text: 'Hello', timestamp: '10:30 AM' },
          { role: 'assistant', text: 'Hi there!', timestamp: '10:31 AM' },
          ...
        ]
      }
      ```
    - âœ… ç¢ºèªæ­£ç¢ºå¾Œæ‰ç¹¼çºŒ

    **æ­¥é©Ÿ 3.4ï¼šäº’å‹•å…ƒç´ **
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `getPromptInput()` - æ‡‰è¿”å› textarea å…ƒç´ 
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `getSendButton()` - æ‡‰è¿”å›ç™¼é€æŒ‰éˆ•
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `getStopButton()` - æ‡‰è¿”å›åœæ­¢æŒ‰éˆ•æˆ– null
    - âœ… ç¢ºèªæ­£ç¢ºå¾Œæ‰ç¹¼çºŒ

    **æ­¥é©Ÿ 3.5ï¼šç‹€æ…‹æŒ‡ç¤ºå™¨**
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `isStreaming()` - æ‡‰è¿”å› boolean
    - ç·¨å¯«ä¸¦æ¸¬è©¦ `getErrorMessage()` - æ‡‰è¿”å›å­—ä¸²æˆ– null
    - âœ… ç¢ºèªæ­£ç¢º

4.  **æœ€çµ‚é©—è­‰**ï¼š
    - ä½¿ç”¨ Playwright MCP é»æ“Šå¦ä¸€å€‹å°è©±
    - é‡æ–°åŸ·è¡Œæ‰€æœ‰ functionsï¼Œç¢ºä¿é€šç”¨æ€§

5.  **ç”¢å‡ºçµæœ**ï¼š
    - æ•´ç†æ‰€æœ‰é©—è­‰éçš„ JavaScript functions æˆå®Œæ•´è…³æœ¬
    - å„²å­˜åˆ° `src/extractors/{ASSISTANT}-extractor.js`
    - ä¾‹å¦‚ï¼š`src/extractors/gemini-extractor.js`ã€`src/extractors/claude-extractor.js`

---

## ğŸ’¡ ä½¿ç”¨ MCP å·¥å…·çš„æœ€ä½³å¯¦è¸

### åŸ·è¡Œ JavaScript Function
ä½¿ç”¨ `mcp__playwright__browser_evaluate` æ™‚ï¼Œå°‡ function åŒ…è£åœ¨ IIFE (Immediately Invoked Function Expression) ä¸­ï¼š

```javascript
// åŸ·è¡Œå–®ä¸€ function
(() => {
  function extractChatList() {
    // ... function å¯¦ç¾
  }
  return extractChatList();
})()
```

### ç†è§£é é¢çµæ§‹
1. å…ˆä½¿ç”¨ `mcp__playwright__browser_snapshot` ç²å–é é¢çš„å¯è¨ªå•æ€§æ¨¹
2. å¦‚æœéœ€è¦è¦–è¦ºåŒ–ï¼Œä½¿ç”¨ `mcp__playwright__browser_take_screenshot`
3. æ ¹æ“šå¿«ç…§ä¸­çš„çµæ§‹ç·¨å¯«é¸æ“‡å™¨

### è™•ç†å‹•æ…‹å…§å®¹
1. ä½¿ç”¨ `mcp__playwright__browser_wait_for` ç­‰å¾…å…§å®¹è¼‰å…¥
2. ä½¿ç”¨ `mcp__playwright__browser_console_messages` æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤
3. ä½¿ç”¨ `mcp__playwright__browser_network_requests` ç›£æ§ç¶²è·¯è«‹æ±‚ç‹€æ…‹

